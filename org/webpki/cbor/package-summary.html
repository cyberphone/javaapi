<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>org.webpki.cbor (WebPKI.org Support)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: org.webpki.cbor">
<meta name="generator" content="javadoc/PackageWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body class="package-declaration-page">
<script type="text/javascript"></script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar.top">
<div class="skip-nav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar.top.firstrow" class="nav-list" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li class="nav-bar-cell1-rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip.navbar.top">
<!--   -->
</span></nav>
</header>
<div class="flex-content">
<main role="main">
<div class="header">
<h1 title="Package" class="title">Package&nbsp;org.webpki.cbor</h1>
</div>
<section class="package-description" id="package.description">
<div class="block"><h2>Basic CBOR support</h2>
This package contains java support for CBOR (RFC 8949).
It is mainly intended for low-level security constructs
like COSE and FIDO/CTAP2.
<h3>Currently Supported Primitives</h3>
<table>
<tr><th>CBOR Data Type</th><th>&nbsp;&nbsp;</th><th>Java Counterpart</th></tr>
<tr><td><code>unsigned integer</code></td><td></td><td><code>long</code></td></tr>
<tr><td><code>negative integer</code></td><td></td><td><code>long</code></td></tr>
<tr><td><code>byte string</code></td><td></td><td><code>byte[]</code></td></tr>
<tr><td><code>text string</code></td><td></td><td><code>String</code></td></tr>
<tr><td><code>unsigned bignum</code></td><td></td><td><code>BigInteger</code></td></tr>
<tr><td><code>negative bignum</code></td><td></td><td><code>BigInteger</code></td></tr>
<tr><td><code>date-time</code></td><td></td><td><code>GregorianCalendar</code></td></tr>
<tr><td><code>true</code></td><td></td><td><code>boolean</code></td></tr>
<tr><td><code>false</code></td><td></td><td><code>boolean</code></td></tr>
<tr><td><code>null</code></td><td></td><td><code>null</code></td></tr>
</table>
<h3>Deterministic Serialization</h3>
Since this package is intended for security related
work, it is (by design) quite picky when decoding CBOR data
and does not accept:
<ul>
<li>Leading zeros.</li>
<li><code>bignum</code> objects
that due to their value could equally well be provided in the
shorter <code>integer</code> format.</li>
<li>Maps with keys that are not sorted according to the selected canonicalization scheme.</li>
</ul>
On output (encode) the preferred serialization format is always used
regardless how it was provided.
<h3>Map Sorting</h3>
Maps are <i>automatically sorted</i> during encode according to section 4.2.3 (which
follows RFC 7049) by default, but can (with an option), be set
to adhere to section 4.2.1.

<h3 id='csf'>Signature Support</h3>
The CBOR library contains support for creating and validating
signatures using a specific scheme called
&quot;CBOR Signature Format&quot; (CSF). 
<p>
Note that unlike COSE (RFC 8152), CSF
leverages <i>deterministic serialization</i>,
enabling constructs like the following:
</p>
<pre>
{
   1: {
     1: "Space Shop",
     2: "100.00",
     3: "EUR"
   },
   2: "spaceshop.com",
   3: "FR7630002111110020050014382",
   4: "https://europeanpaymentsinitiative.eu/fwp",
   5: "62932",
   6: 0("2021-05-03T09:50:08Z"),
   <span style='color:grey'>// signature object</span>
   7: {
     <span style='color:grey'>// Signature algorithm = COSE/ES256</span>
     1: -7,
     <span style='color:grey'>// Public key descriptor in COSE format</span>
     2: {
       <span style='color:grey'>// kty = EC</span>
       1: 2,
       <span style='color:grey'>// crv = P-256</span>
       -1: 1,
       <span style='color:grey'>// x</span>
       -2: h'e812b1a6dcbc708f9ec43cc2921fa0a14e9d5eadcc6dc63471dd4b680c6236b5',
       <span style='color:grey'>// y</span>
       -3: h'9826dcbd4ce6e388f72edd9be413f2425a10f75b5fd83d95fa0cde53159a51d8'
     },
     <span style='color:grey'>// Signature value</span>
     5: h'71994b13d48eeb8e9a5cd2801e11af93af92bb1acfcbd92ef0a4f1bb317faf94ae61e
80443763cf212b9fd28f3c91c92ade64558b4382623320f58dfd785606e'
   }
}
</pre>
<i>Explanation: </i>
Labels 1-6 represent the application data while the <i>application-specific</i>
label 7 holds an associated <i>enveloped</i> signature.  A CBOR signature must
(for compatibility with CSF),
be provided as a CBOR <code>map</code> having a fixed set of labels 
according to the following table:
<table class='webpkitable'>
<tr><th>Label</th><th>Function</th></tr>
<tr><td style='text-align:center'>1</td><td>Signature algorithm using COSE identifiers</td></tr>
<tr><td style='text-align:center'>2</td><td><i>Optional</i> public key in COSE format</td></tr>
<tr><td style='text-align:center'>3</td><td><i>Optional</i> key Id supplied as a <code>text string</code></td></tr>
<tr><td style='text-align:center'>4</td><td><i>Optional</i> certificate path supplied as an array of <code>byte string</code> objects</td></tr>
<tr><td style='text-align:center'>5</td><td>Signature value</td></tr>
</table>
<p>
CSF signatures are validated by running the signature validation 
algorithm over the complete CBOR binary representation, with the signature label (5) and
its associated value as the sole exception. Note that the length
of the <code>map</code> object holding the signature value <b>must</b>
be updated (to reflect the removal of an element) during validation.</p>
<p id='csf-algorithms'>
Currently supported signature algorithms:
</p>
<table class='webpkitable'>
<tr><th>Name</th><th>Identifier</th><th>Compatibility</th></tr>
<tr style='text-align:center'><td><code>Ed25519</code></td><td>-8</td><td>FIDO, PKIX [1]</td></tr>
<tr style='text-align:center'><td><code>Ed448</code></td><td>-9</td><td>PKIX [2]</td></tr>
<tr style='text-align:center'><td><code>ES256</code></td><td>-7</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>ES384</code></td><td>-35</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>ES512</code></td><td>-36</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>PS256</code></td><td>-37</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>PS384</code></td><td>-38</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>PS512</code></td><td>-39</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>RS256</code></td><td>-257</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>RS384</code></td><td>-258</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>RS512</code></td><td>-259</td><td>COSE, JOSE</td></tr>
</table>
<p>[1] Unfortunately, different standards groups did not in due time realize that
existing cryptographic APIs only rarely accept &quot;EdDSA&quot; as a valid signature algorithm.
In current FIDO alliance specifications the COSE <code>EdDSA</code> algorithm identifier has
therefore been redefined to rather mean EdDSA with an Ed25519 key which is also what CSF follows.
PKIX' RFC&nbsp;8410 makes the same distinction.</p>
<p>[2] CSF extends the scheme used for <code>Ed25519</code> to <code>Ed448</code> as well.</p>

<h3 id='cef'>Encryption Support</h3>
The CBOR library contains support for encrypting and decrypting
arbitrary binary data using a specific scheme called
&quot;CBOR Encryption Format&quot; (CEF).
In similarity to CSF, CEF also depends on <i>deterministic serialization</i>
which is used to create authentication data to content encryption
algorithms like GCM.
The following shows a printout of a CEF object using an X25519 key
and the algorithms A256GCM and ECDH-ES+A256KW for content respectively key-wrapping:
<pre>
{
  <span style='color:grey'>// Content encryption algorithm = COSE/A256GCM</span>
  1: 3,
  <span style='color:grey'>// Key encryption object</span>
  2: {
    <span style='color:grey'>// Key encryption algorithm = COSE/ECDH-ES+A256KW</span>
    1: -31,
    <span style='color:grey'>// Key Id</span>
    3: "example.com:x25519",
    <span style='color:grey'>// Ephemeral key descriptor in COSE format</span>
    5: {
      <span style='color:grey'>// kty = OKP</span>
      1: 1,
      <span style='color:grey'>// crv = X25519</span>
      -1: 4,
       <span style='color:grey'>// x</span>
      -2: h'6b073a97a9bc95e68800f0814a7cd02f2446d6cca8581e3a27bfd490fdaaf631'
    },
    <span style='color:grey'>// Encrypted key</span>
    9: h'27c9c0b68841044368ddb3d41ae04bb1ee9535563f90aaaa519c560217b63aa5d578047b3341c697'
  },
  <span style='color:grey'>// Tag</span>
  7: h'6f97609e63b9e99a806e432de4c71d77',
  <span style='color:grey'>// Initialization Vector (IV)</span>
  8: h'ecb5e6a6291eb5c746dd88b0',
  <span style='color:grey'>// Ciphertext</span>
  9: h'debbe59a33066c7436c6b9ce67e1634e80edbaf4b2f0'
}
</pre>
Decryption using the private key (here in JWK format)
<pre>
{
  "kid": "example.com:x25519",
  "kty": "OKP",
  "crv": "X25519",
  "x": "o16U773QQYaQB4eegNCldg6huoIZLsOQIYkFWvbZ5lA",
  "d": "8AMLEwmHm83XsNZ-ZfMxqa4mrPzIuIXOZfQshTJrX2g"
}
</pre>
should return the UTF-8 encoded string &quot;Hello encrypted world!&quot;.
The CEF decryption process is as follows:
<ul>
<li>Read and save the content encryption parameters <code>Tag</code>,
<code>IV</code>, and <code>Ciphertext</code>.</li>
<li>Remove the <code>Tag</code>,
<code>IV</code>, and <code>Ciphertext</code> elements from the
encryption object.
Note that the top level <code>map</code> object <b>must</b> be updated
as well to reflect the changed number of elements.
<li>Serialize the remaining CBOR encryption object and set the result to 
Additional Authentication Data (<code>AAD</code>).</li>
<li>Recover the content encryption key using the elements in the
key encryption object (featured in label 2).</li>
<li>Apply the content encryption algorithm (featured in label 1) to the recovered content encryption key,
using the input parameters read in the first step together with <code>AAD</code>.
The result is the decrypted data.</li>
</ul>
Symmetric key encryption objects are decrypted as above with the following differences:
<ul>
<li>Since there are no key encryption objects, content encryption 
keys <b>must</b> be known in advance by recipients.</li>
<li>Possible key Ids <b>must</b> be supplied in the top-level map.</li>
</ul>
For ECDH-ES key encryption schemes, HKDF-256 according to RFC&nbsp;5869
is profiled as follows:
<ul>
<li><code>salt</code>: N/A. Default extract mode handling <b>must</b> be implemented.</li>
<li><code>info</code>: COSE key encryption algorithms <b>must</b> be expressed as
32-bit (4 byte) signed big-endian integers.</li>
</ul>
<p id='cef-content-encryption-algorithms'>
Currently supported content encryption algorithms:
</p>

<table class='webpkitable' style='margin-bottom:1em'>
<tr><th>Name</th><th>Identifier</th><th>Compatibility</th></tr>
<tr style='text-align:center'><td><code>A128GCM</code></td><td>1</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>A192GCM</code></td><td>2</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>A256GCM</code></td><td>3</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>A128CBC-HS256</code></td><td>200</td><td>JOSE</td></tr>
<tr style='text-align:center'><td><code>A192CBC-HS384</code></td><td>201</td><td>JOSE</td></tr>
<tr style='text-align:center'><td><code>A256CBC-HS512</code></td><td>202</td><td>JOSE</td></tr>
</table>
<p id='cef-key-encryption-algorithms' style='padding-top:1em'>
Currently supported key encryption algorithms:
</p>
<table class='webpkitable'>
<tr><th>Name</th><th>Identifier</th><th>Compatibility</th></tr>
<tr style='text-align:center'><td><code>ECDH-ES</code></td><td>-25</td><td>COSE, JOSE [1]</td></tr>
<tr style='text-align:center'><td><code>ECDH-ES+A128KW</code></td><td>-29</td><td>COSE, JOSE [1]</td></tr>
<tr style='text-align:center'><td><code>ECDH-ES+A192KW</code></td><td>-30</td><td>COSE, JOSE [1]</td></tr>
<tr style='text-align:center'><td><code>ECDH-ES+A256KW</code></td><td>-31</td><td>COSE, JOSE [1]</td></tr>
<tr style='text-align:center'><td><code>RSA-OAEP</code></td><td>-40</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>RSA-OAEP-256</code></td><td>-41</td><td>COSE, JOSE</td></tr>
</table>
<p>
[1] Note that COSE and JOSE do no use the same Key Derivation Function (KDF).
</p></div>
</section>
<section class="summary">
<ul class="summary-list">
<li>
<div class="type-summary">
<table class="summary-table">
<caption><span>Interface Summary</span></caption>
<thead>
<tr>
<th class="col-first" scope="col">Interface</th>
<th class="col-last" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORAsymKeyDecrypter.KeyLocator.html" title="interface in org.webpki.cbor">CBORAsymKeyDecrypter.KeyLocator</a></th>
<td class="col-last">
<div class="block">For dynamic key retrieval.</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORAsymSignatureValidator.KeyLocator.html" title="interface in org.webpki.cbor">CBORAsymSignatureValidator.KeyLocator</a></th>
<td class="col-last">
<div class="block">For dynamic key retrieval.</div>
</td>
</tr>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORHmacValidator.KeyLocator.html" title="interface in org.webpki.cbor">CBORHmacValidator.KeyLocator</a></th>
<td class="col-last">
<div class="block">For dynamic key retrieval.</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORSymKeyDecrypter.KeyLocator.html" title="interface in org.webpki.cbor">CBORSymKeyDecrypter.KeyLocator</a></th>
<td class="col-last">
<div class="block">For dynamic key retrieval.</div>
</td>
</tr>
</tbody>
</table>
</div>
</li>
<li>
<div class="type-summary">
<table class="summary-table">
<caption><span>Class Summary</span></caption>
<thead>
<tr>
<th class="col-first" scope="col">Class</th>
<th class="col-last" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORArray.html" title="class in org.webpki.cbor">CBORArray</a></th>
<td class="col-last">
<div class="block">Class for holding CBOR arrays.</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORAsymKeyDecrypter.html" title="class in org.webpki.cbor">CBORAsymKeyDecrypter</a></th>
<td class="col-last">
<div class="block">Class for CBOR asymmetric key decryption.</div>
</td>
</tr>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORAsymKeyEncrypter.html" title="class in org.webpki.cbor">CBORAsymKeyEncrypter</a></th>
<td class="col-last">
<div class="block">Class for creating CBOR asymmetric key encryptions.</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORAsymKeySigner.html" title="class in org.webpki.cbor">CBORAsymKeySigner</a></th>
<td class="col-last">
<div class="block">Class for creating CBOR asymmetric key signatures.</div>
</td>
</tr>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORAsymSignatureValidator.html" title="class in org.webpki.cbor">CBORAsymSignatureValidator</a></th>
<td class="col-last">
<div class="block">Class for CBOR asymmetric key signature validation.</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORBigInteger.html" title="class in org.webpki.cbor">CBORBigInteger</a></th>
<td class="col-last">
<div class="block">Class for holding CBOR <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/math/BigInteger.html" title="class or interface in java.math" class="external-link"><code>BigInteger</code></a>.</div>
</td>
</tr>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORBoolean.html" title="class in org.webpki.cbor">CBORBoolean</a></th>
<td class="col-last">
<div class="block">Class for holding CBOR <code>true</code> and <code>false</code>.</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORByteString.html" title="class in org.webpki.cbor">CBORByteString</a></th>
<td class="col-last">
<div class="block">Class for holding CBOR byte strings.</div>
</td>
</tr>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORDateTime.html" title="class in org.webpki.cbor">CBORDateTime</a></th>
<td class="col-last">
<div class="block">Class for holding CBOR date-time objects (RFC 3339).</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORDecrypter.html" title="class in org.webpki.cbor">CBORDecrypter</a></th>
<td class="col-last">
<div class="block">Base class for creating CBOR decryption objects.</div>
</td>
</tr>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBOREncrypter.html" title="class in org.webpki.cbor">CBOREncrypter</a></th>
<td class="col-last">
<div class="block">Base class for creating CBOR encryption objects.</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORHmacSigner.html" title="class in org.webpki.cbor">CBORHmacSigner</a></th>
<td class="col-last">
<div class="block">Class for creating CBOR HMAC signatures.</div>
</td>
</tr>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORHmacValidator.html" title="class in org.webpki.cbor">CBORHmacValidator</a></th>
<td class="col-last">
<div class="block">Class for CBOR HMAC signature validation.</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORInteger.html" title="class in org.webpki.cbor">CBORInteger</a></th>
<td class="col-last">
<div class="block">Class for holding CBOR integers.</div>
</td>
</tr>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORMap.html" title="class in org.webpki.cbor">CBORMap</a></th>
<td class="col-last">
<div class="block">Class for holding CBOR maps.</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORNull.html" title="class in org.webpki.cbor">CBORNull</a></th>
<td class="col-last">
<div class="block">Class for holding CBOR <code>null</code>.</div>
</td>
</tr>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORObject.html" title="class in org.webpki.cbor">CBORObject</a></th>
<td class="col-last">
<div class="block">Base class for all CBOR objects.</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORPublicKey.html" title="class in org.webpki.cbor">CBORPublicKey</a></th>
<td class="col-last">
<div class="block">Class for CBOR/COSE public keys</div>
</td>
</tr>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORSigner.html" title="class in org.webpki.cbor">CBORSigner</a></th>
<td class="col-last">
<div class="block">Base class for creating CBOR signatures.</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORSymKeyDecrypter.html" title="class in org.webpki.cbor">CBORSymKeyDecrypter</a></th>
<td class="col-last">
<div class="block">Class for CBOR symmetric key decryption.</div>
</td>
</tr>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORSymKeyEncrypter.html" title="class in org.webpki.cbor">CBORSymKeyEncrypter</a></th>
<td class="col-last">
<div class="block">Class for creating CBOR symmetric key encryptions.</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="CBORTextString.html" title="class in org.webpki.cbor">CBORTextString</a></th>
<td class="col-last">
<div class="block">Class for holding CBOR text strings.</div>
</td>
</tr>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORValidator.html" title="class in org.webpki.cbor">CBORValidator</a></th>
<td class="col-last">
<div class="block">Base class for CBOR signature validation</div>
</td>
</tr>
<tr class="row-color">
<th class="col-first" scope="row"><a href="JSONReader.html" title="class in org.webpki.cbor">JSONReader</a></th>
<td class="col-last">
<div class="block">Class for converting JSON to CBOR.</div>
</td>
</tr>
</tbody>
</table>
</div>
</li>
<li>
<div class="type-summary">
<table class="summary-table">
<caption><span>Enum Summary</span></caption>
<thead>
<tr>
<th class="col-first" scope="col">Enum</th>
<th class="col-last" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="alt-color">
<th class="col-first" scope="row"><a href="CBORTypes.html" title="enum in org.webpki.cbor">CBORTypes</a></th>
<td class="col-last">
<div class="block">Enumeration of CBOR types.</div>
</td>
</tr>
</tbody>
</table>
</div>
</li>
</ul>
</section>
</main>
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottom-nav" id="navbar.bottom">
<div class="skip-nav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar.bottom.firstrow" class="nav-list" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li class="nav-bar-cell1-rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<span class="skip-nav" id="skip.navbar.bottom">
<!--   -->
</span></nav>
<p class="legal-copy"><small><i>2005-2021 WebPKI.org.</i></small></p>
</footer>
</div>
</div>
</body>
</html>
